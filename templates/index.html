<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Golf Tech Analysis - API Test</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 40px;
        max-width: 600px;
        width: 100%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
      }
      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }
      .upload-area {
        border: 3px dashed #667eea;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 20px;
      }
      .upload-area:hover {
        border-color: #764ba2;
        background: rgba(102, 126, 234, 0.05);
      }
      .upload-area.dragover {
        background: rgba(102, 126, 234, 0.1);
        border-color: #764ba2;
      }
      input[type="file"] {
        display: none;
      }
      button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s;
      }
      button:hover:not(:disabled) {
        transform: translateY(-2px);
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .progress {
        display: none;
        margin: 20px 0;
      }
      .progress-bar {
        height: 30px;
        background: #e0e0e0;
        border-radius: 15px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        width: 0%;
        transition: width 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      }
      .result {
        display: none;
        margin-top: 20px;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 10px;
      }
      .result h3 {
        margin-bottom: 10px;
        color: #667eea;
      }
      .score {
        font-size: 48px;
        font-weight: bold;
        text-align: center;
        color: #764ba2;
        margin: 20px 0;
      }
      .info {
        margin: 10px 0;
      }
      .info strong {
        color: #333;
      }
      .download-btn {
        margin-top: 15px;
        background: #28a745;
      }
      .download-btn:hover {
        background: #218838;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üèåÔ∏è Golf Tech Analysis</h1>
      <p class="subtitle">API Testing Interface</p>

      <div class="upload-area" id="uploadArea">
        <div>
          <p style="font-size: 48px">üìπ</p>
          <p style="font-size: 18px; margin-top: 10px">
            Click ho·∫∑c k√©o video v√†o ƒë√¢y
          </p>
          <p style="font-size: 14px; color: #999; margin-top: 5px">
            ƒê·ªãnh d·∫°ng: MP4, MOV, AVI
          </p>
        </div>
        <input type="file" id="fileInput" accept="video/*" />
      </div>

      <button id="analyzeBtn" disabled>Ph√¢n t√≠ch Video</button>

      <div class="progress" id="progress">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill">0%</div>
        </div>
      </div>

      <div class="result" id="result">
        <h3>K·∫øt qu·∫£ ph√¢n t√≠ch</h3>
        <div class="score" id="score">‚Äî</div>
        <div class="info">
          <strong>Tr√¨nh ƒë·ªô:</strong> <span id="level">‚Äî</span>
        </div>
        <div class="info">
          <strong>L·ªói ch√≠nh:</strong> <span id="faults">‚Äî</span>
        </div>
        <button class="download-btn" id="downloadBtn">üì• T·∫£i xu·ªëng JSON</button>
      </div>
    </div>

    <script>
      const uploadArea = document.getElementById("uploadArea");
      const fileInput = document.getElementById("fileInput");
      const analyzeBtn = document.getElementById("analyzeBtn");
      const progress = document.getElementById("progress");
      const progressFill = document.getElementById("progressFill");
      const result = document.getElementById("result");
      const downloadBtn = document.getElementById("downloadBtn");

      let selectedFile = null;
      let jsonResult = null;

      uploadArea.addEventListener("click", () => fileInput.click());

      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });

      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("dragover");
      });

      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          selectedFile = files[0];
          updateUI();
        }
      });

      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          selectedFile = e.target.files[0];
          updateUI();
        }
      });

      function updateUI() {
        if (selectedFile) {
          uploadArea.innerHTML = `
                    <p style="font-size: 24px;">‚úÖ</p>
                    <p><strong>${selectedFile.name}</strong></p>
                    <p style="font-size: 14px; color: #999;">${(
                      selectedFile.size /
                      1024 /
                      1024
                    ).toFixed(2)} MB</p>
                `;
          analyzeBtn.disabled = false;
        }
      }

      analyzeBtn.addEventListener("click", async () => {
        if (!selectedFile) return;

        analyzeBtn.disabled = true;
        progress.style.display = "block";
        result.style.display = "none";

        const formData = new FormData();
        formData.append("file", selectedFile);

        // Simulate progress
        let prog = 0;
        const interval = setInterval(() => {
          prog += 5;
          if (prog <= 90) {
            progressFill.style.width = prog + "%";
            progressFill.textContent = prog + "%";
          }
        }, 200);

        try {
          const response = await fetch("/api/analyze", {
            method: "POST",
            body: formData,
          });

          clearInterval(interval);

          if (response.ok) {
            jsonResult = await response.json();
            progressFill.style.width = "100%";
            progressFill.textContent = "100%";

            setTimeout(() => {
              progress.style.display = "none";
              showResult(jsonResult);
            }, 500);
          } else {
            throw new Error("Analysis failed");
          }
        } catch (error) {
          clearInterval(interval);
          alert("L·ªói: " + error.message);
          analyzeBtn.disabled = false;
          progress.style.display = "none";
        }
      });

      function showResult(data) {
        document.getElementById("score").textContent =
          data.coaching.final_score + "/10";
        document.getElementById("level").textContent =
          data.coaching.skill_level;
        document.getElementById("faults").textContent =
          data.coaching.key_faults.length > 0
            ? data.coaching.key_faults[0]
            : "Kh√¥ng c√≥ l·ªói ƒë√°ng k·ªÉ";

        result.style.display = "block";
        analyzeBtn.disabled = false;
      }

      downloadBtn.addEventListener("click", () => {
        if (jsonResult) {
          const blob = new Blob([JSON.stringify(jsonResult, null, 2)], {
            type: "application/json",
          });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "analysis_result.json";
          a.click();
          URL.revokeObjectURL(url);
        }
      });
    </script>
  </body>
</html>
